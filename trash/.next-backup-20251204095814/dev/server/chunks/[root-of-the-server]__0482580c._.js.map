{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///E:/NextJS/plk-regis-meet/src/authConfig.ts"],"sourcesContent":["import NextAuth, { type Session, type NextAuthConfig } from \"next-auth\";\nimport type { JWT } from \"next-auth/jwt\";\n\nimport CredentialsProvider from \"next-auth/providers/credentials\";\n\nconst authOptions: NextAuthConfig = {\n  session: {\n    strategy: 'jwt',\n    maxAge: 60 * 60 * 24, // 24 hours\n  },\n  providers: [\n    CredentialsProvider({\n      async authorize(credentials) {\n        console.log(\"credentials = \", credentials);\n        if (credentials['cred-way'] == 'user-pass') {\n          // ยังไม่เชื่อมต่อฐานข้อมูลจริง: ให้ login แบบ user-pass ไม่สำเร็จไปก่อน\n          /*\n           NOTE: โค้ด prisma ด้านล่างถูก comment ไว้ เพื่อให้ build ผ่าน\n           แต่ยังเก็บเป็นตัวอย่างเผื่อเชื่อมฐานข้อมูลภายหลัง\n\n           const user = await prisma.user.findUnique({\n             where: {\n               username: credentials?.username as string,\n             },\n           });\n           if (!user) {\n             return null; // ทำให้ auth fail และ redirect กลับหน้า sign-in\n           }\n           return {\n             name: user.username,\n             profile: JSON.stringify(user),\n             ssj_department: (user as any).ssj_department,\n           };\n          */\n\n          return null; // จะทำให้ authentication fail และ redirect กลับหน้า sign-in\n        }\n        return {\n          name: (credentials as any).username as string || 'health-id',\n          profile: (credentials as any).profile!\n        };\n      },\n    })\n  ],\n  callbacks: {\n    async jwt({ token, user }: { token: JWT; user?: any }) {\n      if (user) {        \n        (token as any).profile = (user as any).profile;\n      }\n      return token;\n    },\n    async session({ session, token }: { session: Session; token: JWT }) {\n      if (token && session.user) {\n        (session.user as any).profile = (token as any).profile;        \n      }\n      return session;\n    }\n  }\n}\n\nexport const {\n  handlers,\n  auth,\n  signIn,\n  signOut,\n} = NextAuth(authOptions);\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAGA;;;AAEA,MAAM,cAA8B;IAClC,SAAS;QACP,UAAU;QACV,QAAQ,KAAK,KAAK;IACpB;IACA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM,WAAU,WAAW;gBACzB,QAAQ,GAAG,CAAC,kBAAkB;gBAC9B,IAAI,WAAW,CAAC,WAAW,IAAI,aAAa;oBAC1C,wEAAwE;oBACxE;;;;;;;;;;;;;;;;;UAiBA,GAEA,OAAO,MAAM,4DAA4D;gBAC3E;gBACA,OAAO;oBACL,MAAM,AAAC,YAAoB,QAAQ,IAAc;oBACjD,SAAS,AAAC,YAAoB,OAAO;gBACvC;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAA8B;YACnD,IAAI,MAAM;gBACP,MAAc,OAAO,GAAG,AAAC,KAAa,OAAO;YAChD;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAoC;YAChE,IAAI,SAAS,QAAQ,IAAI,EAAE;gBACxB,QAAQ,IAAI,CAAS,OAAO,GAAG,AAAC,MAAc,OAAO;YACxD;YACA,OAAO;QACT;IACF;AACF;AAEO,MAAM,EACX,QAAQ,EACR,IAAI,EACJ,MAAM,EACN,OAAO,EACR,GAAG,IAAA,kJAAQ,EAAC"}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///E:/NextJS/plk-regis-meet/src/app/api/auth/healthid/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { signIn } from '@/authConfig'\nimport { redirect } from 'next/navigation';\nimport { cookies } from 'next/headers';\n\nexport async function GET(request: NextRequest) {\n    const { searchParams } = request.nextUrl;\n    const code = searchParams.get('code');\n    \n    // Get redirectTo from cookie\n    const cookieStore = await cookies();\n    const redirectTo = cookieStore.get('redirectTo')?.value || '/home';\n\n    if (!code) {\n        return NextResponse.json({ error: 'Authorization code is missing' }, { status: 400 });\n    }\n    console.log(\"Authorization Health id Code :\", code);\n\n    const response = await fetch('https://moph.id.th/api/v1/token', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n            grant_type: 'authorization_code',\n            code: code,\n            redirect_uri: process.env.HEALTH_REDIRECT_URI,\n            client_id: process.env.HEALTH_CLIENT_ID,\n            client_secret: process.env.HEALTH_CLIENT_SECRET\n        })\n    });\n    const data = await response.json();\n    if (!response.ok) {\n        return NextResponse.json({ error: data.error || 'Failed to fetch Health ID token' }, { status: response.status });\n    }\n    // Removed sensitive data logging for security\n\n\n    const userResponse = await fetch('https://provider.id.th/api/v1/services/token', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n            client_id: process.env.PROVIDER_CLIENT_ID,\n            secret_key: process.env.PROVIDER_CLIENT_SECRET, // Changed from PROVIDER_SECRET_KEY\n            token_by: 'Health ID',\n            token: data.data.access_token\n        })\n    });\n    const userData = await userResponse.json();\n    // Removed sensitive data logging for security\n    if (!userResponse.ok) {\n        return NextResponse.json({ error: userData.error || 'Failed to fetch provider data' }, { status: userResponse.status });\n    }\n\n    const profileResponse = await fetch('https://provider.id.th/api/v1/services/profile?position_type=1', {\n        method: 'GET',\n        headers: {\n            'client-id': process.env.PROVIDER_CLIENT_ID!,\n            'secret-key': process.env.PROVIDER_CLIENT_SECRET!,\n            'Authorization': `Bearer ${userData.data.access_token}`\n        }\n\n    });\n    const profileData = await profileResponse.json();\n    // Removed sensitive data logging for security\n    if (!profileResponse.ok) {\n        return NextResponse.json({ error: profileData.error || 'Failed to fetch profile data' }, { status: profileResponse.status });\n    }\n\n    //return NextResponse.json(profileData.data);\n    const res = await signIn('credentials', {\n        'cred-way': 'health-id',\n        'profile': JSON.stringify(profileData.data),\n        redirectTo: redirectTo\n    });\n    console.log(\"res sign in = \", res);\n    \n    // Return the signIn result to ensure proper route handler response\n    return res;\n}"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;;;;AAEO,eAAe,IAAI,OAAoB;IAC1C,MAAM,EAAE,YAAY,EAAE,GAAG,QAAQ,OAAO;IACxC,MAAM,OAAO,aAAa,GAAG,CAAC;IAE9B,6BAA6B;IAC7B,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,aAAa,YAAY,GAAG,CAAC,eAAe,SAAS;IAE3D,IAAI,CAAC,MAAM;QACP,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACvF;IACA,QAAQ,GAAG,CAAC,kCAAkC;IAE9C,MAAM,WAAW,MAAM,MAAM,mCAAmC;QAC5D,QAAQ;QACR,SAAS;YACL,gBAAgB;QACpB;QACA,MAAM,KAAK,SAAS,CAAC;YACjB,YAAY;YACZ,MAAM;YACN,cAAc,QAAQ,GAAG,CAAC,mBAAmB;YAC7C,WAAW,QAAQ,GAAG,CAAC,gBAAgB;YACvC,eAAe,QAAQ,GAAG,CAAC,oBAAoB;QACnD;IACJ;IACA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,IAAI,CAAC,SAAS,EAAE,EAAE;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,KAAK,IAAI;QAAkC,GAAG;YAAE,QAAQ,SAAS,MAAM;QAAC;IACnH;IACA,8CAA8C;IAG9C,MAAM,eAAe,MAAM,MAAM,gDAAgD;QAC7E,QAAQ;QACR,SAAS;YACL,gBAAgB;QACpB;QACA,MAAM,KAAK,SAAS,CAAC;YACjB,WAAW,QAAQ,GAAG,CAAC,kBAAkB;YACzC,YAAY,QAAQ,GAAG,CAAC,sBAAsB;YAC9C,UAAU;YACV,OAAO,KAAK,IAAI,CAAC,YAAY;QACjC;IACJ;IACA,MAAM,WAAW,MAAM,aAAa,IAAI;IACxC,8CAA8C;IAC9C,IAAI,CAAC,aAAa,EAAE,EAAE;QAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,SAAS,KAAK,IAAI;QAAgC,GAAG;YAAE,QAAQ,aAAa,MAAM;QAAC;IACzH;IAEA,MAAM,kBAAkB,MAAM,MAAM,kEAAkE;QAClG,QAAQ;QACR,SAAS;YACL,aAAa,QAAQ,GAAG,CAAC,kBAAkB;YAC3C,cAAc,QAAQ,GAAG,CAAC,sBAAsB;YAChD,iBAAiB,CAAC,OAAO,EAAE,SAAS,IAAI,CAAC,YAAY,EAAE;QAC3D;IAEJ;IACA,MAAM,cAAc,MAAM,gBAAgB,IAAI;IAC9C,8CAA8C;IAC9C,IAAI,CAAC,gBAAgB,EAAE,EAAE;QACrB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,YAAY,KAAK,IAAI;QAA+B,GAAG;YAAE,QAAQ,gBAAgB,MAAM;QAAC;IAC9H;IAEA,6CAA6C;IAC7C,MAAM,MAAM,MAAM,IAAA,6HAAM,EAAC,eAAe;QACpC,YAAY;QACZ,WAAW,KAAK,SAAS,CAAC,YAAY,IAAI;QAC1C,YAAY;IAChB;IACA,QAAQ,GAAG,CAAC,kBAAkB;IAE9B,mEAAmE;IACnE,OAAO;AACX"}}]
}