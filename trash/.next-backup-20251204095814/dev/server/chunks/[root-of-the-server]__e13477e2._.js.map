{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///E:/NextJS/plk-regis-meet/src/authConfig.ts"],"sourcesContent":["import NextAuth, { type Session, type NextAuthConfig } from \"next-auth\";\r\nimport type { JWT } from \"next-auth/jwt\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\n\r\nconst authOptions: NextAuthConfig = {\r\n  session: {\r\n    strategy: 'jwt',\r\n    maxAge: 60 * 60 * 25, // 25 hours\r\n  },\r\n  providers: [\r\n    CredentialsProvider({\r\n      async authorize(credentials) {\r\n        console.log(\"credentials = \", credentials);\r\n        if (credentials['cred-way'] == 'user-pass') {\r\n          // ยังไม่เชื่อมต่อฐานข้อมูลจริง: ให้ login แบบ user-pass ไม่สำเร็จไปก่อน\r\n          /*\r\n           NOTE: โค้ด prisma ด้านล่างถูก comment ไว้ เพื่อให้ build ผ่าน\r\n           แต่ยังเก็บเป็นตัวอย่างเผื่อเชื่อมฐานข้อมูลภายหลัง\r\n\r\n           const user = await prisma.user.findUnique({\r\n             where: {\r\n               username: credentials?.username as string,\r\n             },\r\n           });\r\n           if (!user) {\r\n             return null; // ทำให้ auth fail และ redirect กลับหน้า sign-in\r\n           }\r\n           return {\r\n             name: user.username,\r\n             profile: JSON.stringify(user),\r\n             ssj_department: (user as any).ssj_department,\r\n           };\r\n          */\r\n\r\n          return null; // จะทำให้ authentication fail และ redirect กลับหน้า sign-in\r\n        }\r\n        return {\r\n          name: 'provider-id',\r\n          profile: credentials.profile!\r\n        };\r\n      }\r\n    })\r\n  ],\r\n  callbacks: {\r\n    async jwt({ token, user }: { token: JWT; user?: any }) {\r\n      if (user) {      \r\n        token.profile = (user as any).profile;      \r\n      }\r\n      return token;\r\n    },\r\n    async session({ session, token }: { session: Session; token: JWT }) {\r\n      if (token && session.user) {\r\n        (session.user as any).profile = (token as any).profile; // Add user profile to the session\r\n      }\r\n      return session;\r\n    },\r\n  },\r\n}\r\n\r\nexport const {\r\n  handlers,\r\n  auth,\r\n  signIn,\r\n  signOut,\r\n} = NextAuth(authOptions);"],"names":[],"mappings":";;;;;;;;;;AAAA;AAEA;AAAA;;;AAEA,MAAM,cAA8B;IAClC,SAAS;QACP,UAAU;QACV,QAAQ,KAAK,KAAK;IACpB;IACA,WAAW;QACT,IAAA,uKAAmB,EAAC;YAClB,MAAM,WAAU,WAAW;gBACzB,QAAQ,GAAG,CAAC,kBAAkB;gBAC9B,IAAI,WAAW,CAAC,WAAW,IAAI,aAAa;oBAC1C,wEAAwE;oBACxE;;;;;;;;;;;;;;;;;UAiBA,GAEA,OAAO,MAAM,4DAA4D;gBAC3E;gBACA,OAAO;oBACL,MAAM;oBACN,SAAS,YAAY,OAAO;gBAC9B;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAA8B;YACnD,IAAI,MAAM;gBACR,MAAM,OAAO,GAAG,AAAC,KAAa,OAAO;YACvC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAoC;YAChE,IAAI,SAAS,QAAQ,IAAI,EAAE;gBACxB,QAAQ,IAAI,CAAS,OAAO,GAAG,AAAC,MAAc,OAAO,EAAE,kCAAkC;YAC5F;YACA,OAAO;QACT;IACF;AACF;AAEO,MAAM,EACX,QAAQ,EACR,IAAI,EACJ,MAAM,EACN,OAAO,EACR,GAAG,IAAA,kKAAQ,EAAC"}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///E:/NextJS/plk-regis-meet/src/app/api/auth/healthid/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { cookies } from 'next/headers';\nimport { signIn } from '@/authConfig'\n\nexport async function GET(request: NextRequest) {\n    const { searchParams } = request.nextUrl;\n    const code = searchParams.get('code');\n    const landing = searchParams.get('landing')\n    const is_auth = searchParams.get('is_auth') === 'yes';\n    const redirectTo = landing || '/';\n\n    if (!code) {\n        return NextResponse.json({ error: 'Authorization code is missing' }, { status: 400 });\n    }\n    console.log(\"Authorization Health id Code :\", code);\n\n    const response = await fetch('https://moph.id.th/api/v1/token', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n            grant_type: 'authorization_code',\n            code: code,\n            redirect_uri: process.env.HEALTH_REDIRECT_URI,\n            client_id: process.env.HEALTH_CLIENT_ID,\n            client_secret: process.env.HEALTH_CLIENT_SECRET\n        })\n    });\n    const data = await response.json();\n    if (!response.ok) {\n        return NextResponse.json({ error: data.error || 'Failed to fetch Health ID token' }, { status: response.status });\n    }\n    // Removed sensitive data logging for security\n\n\n    const userResponse = await fetch('https://provider.id.th/api/v1/services/token', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n            client_id: process.env.PROVIDER_CLIENT_ID,\n            secret_key: process.env.PROVIDER_CLIENT_SECRET, // Changed from PROVIDER_SECRET_KEY\n            token_by: 'Health ID',\n            token: data.data.access_token\n        })\n    });\n    const userData = await userResponse.json();\n    // Removed sensitive data logging for security\n    if (!userResponse.ok) {\n        return NextResponse.json({ error: userData.error || 'Failed to fetch provider data' }, { status: userResponse.status });\n    }\n\n    const profileResponse = await fetch('https://provider.id.th/api/v1/services/profile?position_type=1', {\n        method: 'GET',\n        headers: {\n            'client-id': process.env.PROVIDER_CLIENT_ID!,\n            'secret-key': process.env.PROVIDER_CLIENT_SECRET!,\n            'Authorization': `Bearer ${userData.data.access_token}`\n        }\n\n    });\n    const profileData = await profileResponse.json();\n    // Removed sensitive data logging for security\n    if (!profileResponse.ok) {\n        return NextResponse.json({ error: profileData.error || 'Failed to fetch profile data' }, { status: profileResponse.status });\n    }\n\n    if (!is_auth) {\n        //เก็บ profileData.data ลง session\n        //redirectpage ไปที่ตัวแปร landing\n        const res = NextResponse.redirect(new URL(redirectTo, request.url));\n        res.cookies.set('profile', JSON.stringify(profileData.data), {\n            httpOnly: true,\n            secure: true,\n            sameSite: 'lax',\n            path: '/',\n            maxAge: 60 * 10, // 10 minutes\n        });\n        return res;\n    }\n    \n    const res = await signIn('credentials', {\n        'cred-way': 'provider-id',\n        'profile': JSON.stringify(profileData.data),\n        redirectTo: redirectTo\n    });\n    console.log(\"res sign in = \", res);\n    \n    // Return the signIn result to ensure proper route handler response\n    return res;\n}"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEO,eAAe,IAAI,OAAoB;IAC1C,MAAM,EAAE,YAAY,EAAE,GAAG,QAAQ,OAAO;IACxC,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,UAAU,aAAa,GAAG,CAAC;IACjC,MAAM,UAAU,aAAa,GAAG,CAAC,eAAe;IAChD,MAAM,aAAa,WAAW;IAE9B,IAAI,CAAC,MAAM;QACP,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACvF;IACA,QAAQ,GAAG,CAAC,kCAAkC;IAE9C,MAAM,WAAW,MAAM,MAAM,mCAAmC;QAC5D,QAAQ;QACR,SAAS;YACL,gBAAgB;QACpB;QACA,MAAM,KAAK,SAAS,CAAC;YACjB,YAAY;YACZ,MAAM;YACN,cAAc,QAAQ,GAAG,CAAC,mBAAmB;YAC7C,WAAW,QAAQ,GAAG,CAAC,gBAAgB;YACvC,eAAe,QAAQ,GAAG,CAAC,oBAAoB;QACnD;IACJ;IACA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,IAAI,CAAC,SAAS,EAAE,EAAE;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,KAAK,IAAI;QAAkC,GAAG;YAAE,QAAQ,SAAS,MAAM;QAAC;IACnH;IACA,8CAA8C;IAG9C,MAAM,eAAe,MAAM,MAAM,gDAAgD;QAC7E,QAAQ;QACR,SAAS;YACL,gBAAgB;QACpB;QACA,MAAM,KAAK,SAAS,CAAC;YACjB,WAAW,QAAQ,GAAG,CAAC,kBAAkB;YACzC,YAAY,QAAQ,GAAG,CAAC,sBAAsB;YAC9C,UAAU;YACV,OAAO,KAAK,IAAI,CAAC,YAAY;QACjC;IACJ;IACA,MAAM,WAAW,MAAM,aAAa,IAAI;IACxC,8CAA8C;IAC9C,IAAI,CAAC,aAAa,EAAE,EAAE;QAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,SAAS,KAAK,IAAI;QAAgC,GAAG;YAAE,QAAQ,aAAa,MAAM;QAAC;IACzH;IAEA,MAAM,kBAAkB,MAAM,MAAM,kEAAkE;QAClG,QAAQ;QACR,SAAS;YACL,aAAa,QAAQ,GAAG,CAAC,kBAAkB;YAC3C,cAAc,QAAQ,GAAG,CAAC,sBAAsB;YAChD,iBAAiB,CAAC,OAAO,EAAE,SAAS,IAAI,CAAC,YAAY,EAAE;QAC3D;IAEJ;IACA,MAAM,cAAc,MAAM,gBAAgB,IAAI;IAC9C,8CAA8C;IAC9C,IAAI,CAAC,gBAAgB,EAAE,EAAE;QACrB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,YAAY,KAAK,IAAI;QAA+B,GAAG;YAAE,QAAQ,gBAAgB,MAAM;QAAC;IAC9H;IAEA,IAAI,CAAC,SAAS;QACV,kCAAkC;QAClC,kCAAkC;QAClC,MAAM,MAAM,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;QACjE,IAAI,OAAO,CAAC,GAAG,CAAC,WAAW,KAAK,SAAS,CAAC,YAAY,IAAI,GAAG;YACzD,UAAU;YACV,QAAQ;YACR,UAAU;YACV,MAAM;YACN,QAAQ,KAAK;QACjB;QACA,OAAO;IACX;IAEA,MAAM,MAAM,MAAM,IAAA,6HAAM,EAAC,eAAe;QACpC,YAAY;QACZ,WAAW,KAAK,SAAS,CAAC,YAAY,IAAI;QAC1C,YAAY;IAChB;IACA,QAAQ,GAAG,CAAC,kBAAkB;IAE9B,mEAAmE;IACnE,OAAO;AACX"}}]
}